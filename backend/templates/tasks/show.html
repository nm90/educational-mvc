<!--
    Task Detail Template - Shows a single task with all details

    MVC Role: VIEW
    - Receives 'task' object from Controller (TaskController.show)
    - Displays task details and related user information
    - Contains NO business logic - only presentation

    Data from Controller:
    - task: Dict with:
      * Basic fields: id, title, description, status, priority, created_at, updated_at
      * Related objects: owner (User), assignee (User or null)

    Learning Purpose:
    - Shows how View displays a single object with relationships
    - Demonstrates accessing nested properties (task.owner.name, task.assignee.email)
    - Shows nullable relationship handling
    - Lesson 4 covers task relationships

    Key MVC Concepts:
    - View receives task with eager-loaded relationships
    - View just displays properties - doesn't fetch additional data
    - Controller orchestrated the query including relationships
-->
{% extends "base.html" %}

{% block content %}
    <h1>{{ task.title }}</h1>

    <!-- Task Information -->
    <!--
        The 'task' variable comes from the Controller.
        Controller called Task.get_by_id(id) (Model) and passed the result here.
        View just displays the properties - it doesn't query the database.
    -->
    <table>
        <tr>
            <th style="width: 150px;">Description</th>
            <td>{{ task.description }}</td>
        </tr>
        <tr>
            <th>Status</th>
            <td>
                <span class="badge badge-status-{{ task.status }}">
                    {{ task.status | replace('-', ' ') | title }}
                </span>
            </td>
        </tr>
        <tr>
            <th>Priority</th>
            <td>
                <span class="badge badge-priority-{{ task.priority }}">
                    {{ task.priority | title }}
                </span>
            </td>
        </tr>
        <tr>
            <th>Created At</th>
            <td class="text-muted">{{ task.created_at }}</td>
        </tr>
        <tr>
            <th>Updated At</th>
            <td class="text-muted">{{ task.updated_at }}</td>
        </tr>
    </table>

    <!-- Owner Information -->
    <!--
        Shows details of the task owner (User relationship).
        This demonstrates how Views access related objects.
        Lesson 4 covers relationship eager loading.
    -->
    <h2 style="margin-top: 30px;">Owner</h2>
    <table>
        <tr>
            <th style="width: 150px;">Name</th>
            <td>{{ task.owner.name }}</td>
        </tr>
        <tr>
            <th>Email</th>
            <td>{{ task.owner.email }}</td>
        </tr>
    </table>

    <!-- Assignee Information (if assigned) -->
    <!--
        Shows details of the assignee, or "Unassigned" if null.
        This demonstrates handling nullable relationships.
        assignee_id can be null in the database.
    -->
    <h2 style="margin-top: 30px;">Assigned To</h2>
    {% if task.assignee %}
        <table>
            <tr>
                <th style="width: 150px;">Name</th>
                <td>{{ task.assignee.name }}</td>
            </tr>
            <tr>
                <th>Email</th>
                <td>{{ task.assignee.email }}</td>
            </tr>
        </table>
    {% else %}
        <p class="text-muted">This task is not assigned to anyone.</p>
    {% endif %}

    <!-- Action Links -->
    <!--
        These links navigate to other Controller actions.
        View provides navigation, Controller handles each route.
    -->
    <div class="mt-20">
        <!-- Edit link - navigates to edit form -->
        <a href="{{ url_for('tasks.edit', task_id=task.id) }}" class="btn btn-primary">Edit</a>

        <!-- Delete form -->
        <!--
            Delete uses POST method because it modifies data.
            Lesson 5 covers why we use POST for destructive actions.
        -->
        <form action="{{ url_for('tasks.delete', task_id=task.id) }}" method="POST" style="display: inline;" data-async>
            <button type="submit" class="btn btn-danger" onclick="return confirm('Are you sure you want to delete this task?');">Delete</button>
        </form>

        <!-- Back to list link -->
        <a href="{{ url_for('tasks.index') }}" class="btn btn-secondary">Back to List</a>
    </div>
{% endblock %}
