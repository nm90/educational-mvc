<!--
    Edit Task Form Template - Form for updating an existing task

    MVC Role: VIEW
    - Receives 'task' object from Controller to pre-fill form
    - Form posts to Controller (POST /tasks/<id>/update)
    - If validation fails, Controller re-renders with error and submitted values
    - Contains NO validation logic - only presentation

    Data from Controller:
    - task: Dict with current task data
      * On initial load: fetched via Task.get_by_id()
      * On validation error: contains submitted values
      * Includes relationships: owner, assignee
    - users: List of all users for owner and assignee dropdowns

    Learning Purpose:
    - Shows how Controller passes existing data to pre-fill forms
    - Demonstrates the edit/update pattern in MVC
    - Shows how to select correct option in dropdowns
    - Demonstrates preserving relationship choices
    - Lesson 5 covers update flow through Model

    MVC Flow for form submission:
    1. User modifies form and clicks Update
    2. Browser POSTs to /tasks/<id>/update (Controller.update)
    3. Controller extracts form data
    4. Controller calls Task.update() (Model)
    5. Model validates:
       - If valid: updates DB, Controller redirects to /tasks/<id>
       - If invalid: Model raises ValueError, Controller re-renders with error
    6. View displays validation errors and repopulates form with submitted values
-->
{% extends "base.html" %}

{% block content %}
    <h1>Edit Task</h1>

    <!-- Task Edit Form -->
    <!--
        Form submits to POST /tasks/<id>/update (TaskController.update)
        Pre-filled with current task data from Controller
    -->
    <form action="{{ url_for('tasks.update', task_id=task.id) }}" method="POST" data-async>
        <!-- Title Field -->
        <label for="title">Title *</label>
        <!--
            Pre-filled with task.title from Controller.
            If validation failed, this contains the submitted value.
        -->
        <input type="text"
               id="title"
               name="title"
               value="{{ task.title }}"
               required
               placeholder="Enter task title">

        <!-- Description Field -->
        <label for="description">Description *</label>
        <!--
            Pre-filled with task.description from Controller.
        -->
        <textarea id="description"
                  name="description"
                  required
                  placeholder="Enter task description">{{ task.description }}</textarea>

        <!-- Status Dropdown -->
        <label for="status">Status *</label>
        <!--
            Dropdown showing valid status values.
            Pre-selected with task.status from Controller.
            If validation failed, contains submitted value.
        -->
        <select id="status" name="status" required>
            <option value="todo" {% if task.status == 'todo' %}selected{% endif %}>To Do</option>
            <option value="in-progress" {% if task.status == 'in-progress' %}selected{% endif %}>In Progress</option>
            <option value="done" {% if task.status == 'done' %}selected{% endif %}>Done</option>
        </select>

        <!-- Priority Dropdown -->
        <label for="priority">Priority *</label>
        <!--
            Dropdown showing valid priority values.
            Pre-selected with task.priority from Controller.
        -->
        <select id="priority" name="priority" required>
            <option value="low" {% if task.priority == 'low' %}selected{% endif %}>Low</option>
            <option value="medium" {% if task.priority == 'medium' %}selected{% endif %}>Medium</option>
            <option value="high" {% if task.priority == 'high' %}selected{% endif %}>High</option>
        </select>

        <!-- Owner Dropdown -->
        <label for="owner_id">Owner *</label>
        <!--
            Dropdown showing all users from Controller.
            Pre-selected with task.owner_id from Controller.
            Owner is required - every task must have an owner.
        -->
        <select id="owner_id" name="owner_id" required>
            <option value="">-- Select Owner --</option>
            {% for user in users %}
                <option value="{{ user.id }}" {% if task.owner_id == user.id %}selected{% endif %}>
                    {{ user.name }}
                </option>
            {% endfor %}
        </select>

        <!-- Assignee Dropdown -->
        <label for="assignee_id">Assigned To</label>
        <!--
            Dropdown showing all users plus "Unassigned" option.
            Pre-selected with task.assignee_id from Controller.
            Assignee is optional - can be null.
            Demonstrates preserving nullable relationship choices.
        -->
        <select id="assignee_id" name="assignee_id">
            <option value="">-- Unassigned --</option>
            {% for user in users %}
                <option value="{{ user.id }}" {% if task.assignee_id == user.id %}selected{% endif %}>
                    {{ user.name }}
                </option>
            {% endfor %}
        </select>

        <!-- Form Actions -->
        <div class="mt-20">
            <button type="submit" class="btn btn-primary">Update Task</button>
            <a href="{{ url_for('tasks.show', task_id=task.id) }}" class="btn btn-secondary">Cancel</a>
        </div>
    </form>

    <!-- Back to List -->
    <p class="mt-20">
        <a href="{{ url_for('tasks.index') }}">&larr; Back to Task List</a>
    </p>
{% endblock %}
